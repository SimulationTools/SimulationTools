Notebook[{

Cell[CellGroupData[{
Cell["\<\
Numerical Relativity in SimulationTools\
\>", "Title"],

Cell[CellGroupData[{

Cell["Getting Started", "Section"],

Cell["Load the package", "MathCaption"],

Cell[BoxData[
 RowBox[{"<<", "SimulationTools`"}]], "Input"],

Cell[TextData[{
 "Set the ",
 Cell[BoxData[
  ButtonBox["$SimulationPath",
   BaseStyle->"Link",
   ButtonData->"paclet:Global/ref/$SimulationPath"]], "InlineFormula"],
 " variable to the directory containing your simulations"
}], "MathCaption"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"$SimulationPath", "=", 
    RowBox[{"$HomeDirectory", "<>", "\"\</Simulations\>\""}]}], ";"}], 
  "*)"}]], "Input"],

Cell[TextData[{
 "There are many functions in the ",
 ButtonBox["SimulationTools",
  BaseStyle->"Link",
  ButtonData->"paclet:SimulationTools/guide/SimulationTools"],
 " package contains functions for dealing with NR waveforms, BH trajectories, \
apparent horizons, run statistics, convergence testing and more. "
}], "Text"],

Cell["\<\
In this tutorial we look at a binary black hole simulation called \
\[OpenCurlyDoubleQuote]bbh\[CloseCurlyDoubleQuote] (this is the example \
simulation which is distributed with SimulationTools).\
\>", "MathCaption"],

Cell[BoxData[
 RowBox[{
  RowBox[{"run", " ", "=", " ", "\"\<bbh\>\""}], ";"}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Waveforms", "Section"],

Cell[BoxData[GridBox[{
   {"ReadPsi4", Cell["Re", "TableText"]},
   {"Phase", Cell["Im", "TableText"]},
   {"Frequency", Cell["Abs", "TableText"]}
  }]], "DefinitionBox"],

Cell["\<\
Basic functions for working with Numerical Relativity waveforms.\
\>", "Caption"],

Cell["\<\
Read (2,2) mode of waveform extracted at r=100M from a simulation\
\>", "MathCaption"],

Cell[BoxData[
 RowBox[{"psi4", "=", 
  RowBox[{"ReadPsi4", "[", 
   RowBox[{"run", ",", "2", ",", "2", ",", "100"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Re", "[", "psi4", "]"}], ",", 
     RowBox[{"Im", "[", "psi4", "]"}], ",", 
     RowBox[{"Abs", "[", "psi4", "]"}]}], "}"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{
   RowBox[{"Phase", "[", "psi4", "]"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{
   RowBox[{"Frequency", "[", "psi4", "]"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], "]"}]], "Input"],

Cell[BoxData[GridBox[{
   {"WaveformCycles", "Psi4ToStrain"},
   {"ReadWaveformCycles", Cell["WaveformMatch", "TableText"]},
   {"Frequency", Cell["", "TableText"]}
  }]], "DefinitionBox"],

Cell["\<\
Functions for doing data analysis on Numerical Relativity waveforms.\
\>", "Caption"],

Cell["Get the Advanced LIGO Zero Det, High Power noise curve", "MathCaption"],

Cell[BoxData[
 RowBox[{"sn", "=", 
  RowBox[{"ToDataTable", "[", 
   RowBox[{"Import", "[", 
    RowBox[{
    "\"\<https://dcc.ligo.org/public/0002/T0900288/003/ZERO_DET_high_P.txt\>\"\
", ",", "\"\<TABLE\>\""}], "]"}], "]"}]}]], "Input"],

Cell["\<\
Get the strain waveform extracted at r=30M and r=100M from a binary black \
hole simulation\
\>", "MathCaption"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"f0", "=", "0.2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"h30", "=", 
   RowBox[{"Psi4ToStrain", "[", 
    RowBox[{
     RowBox[{"Shifted", "[", 
      RowBox[{
       RowBox[{"30", 
        RowBox[{"ReadPsi4", "[", 
         RowBox[{"run", ",", "2", ",", "2", ",", "30"}], "]"}]}], ",", 
       RowBox[{"-", 
        RowBox[{"TortoiseCoordinate", "[", 
         RowBox[{"30", ",", 
          RowBox[{"ReadADMMass", "[", "run", "]"}]}], "]"}]}]}], "]"}], ",", 
     "f0"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"h100", "=", 
   RowBox[{"Psi4ToStrain", "[", 
    RowBox[{
     RowBox[{"Shifted", "[", 
      RowBox[{
       RowBox[{"100", 
        RowBox[{"ReadPsi4", "[", 
         RowBox[{"run", ",", "2", ",", "2", ",", "100"}], "]"}]}], ",", 
       RowBox[{"-", 
        RowBox[{"TortoiseCoordinate", "[", 
         RowBox[{"100", ",", 
          RowBox[{"ReadADMMass", "[", "run", "]"}]}], "]"}]}]}], "]"}], ",", 
     "f0"}], "]"}]}], ";"}]}], "Input"],

Cell["\<\
Convert the time variable from units of the binary mass to seconds, assuming \
the mass of the binary is 60 solar masses\
\>", "MathCaption"],

Cell[BoxData[
 RowBox[{
  RowBox[{"rescaleTime", "[", 
   RowBox[{"{", 
    RowBox[{"t_", ",", "f_"}], "}"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"60", "SolarMassInSeconds", " ", "t"}], ",", "f"}], 
   "}"}]}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"h30", "=", 
   RowBox[{"MapList", "[", 
    RowBox[{"rescaleTime", ",", "h30"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"h100", "=", 
   RowBox[{"MapList", "[", 
    RowBox[{"rescaleTime", ",", "h100"}], "]"}]}], ";"}]}], "Input"],

Cell["Compute the match between the two waveforms", "MathCaption"],

Cell[BoxData[
 RowBox[{"WaveformMatch", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"h30", ",", "h100"}], "}"}], ",", "sn"}], "]"}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Trajectories", "Section"],

Cell["\<\
These functions can be used with output from either PunctureTracker or \
MinTracker, and the latter could be used to track neutron stars.\
\>", "Text"],

Cell[BoxData[GridBox[{
   {"ReadBHTrajectory", Cell["ReadBHSeparation", "TableText"]},
   {"ReadBHCoordinates", Cell["ReadBHPhase", "TableText"]}
  }]], "DefinitionBox"],

Cell["Functions for dealing with coordinate trajectories.", "Caption"],

Cell["Puncture 0 trajectory", "MathCaption"],

Cell[BoxData[
 RowBox[{
  RowBox[{"traj0", "=", 
   RowBox[{"ReadBHTrajectory", "[", 
    RowBox[{"run", ",", "0"}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"Take", "[", 
  RowBox[{"traj0", ",", "10"}], "]"}]], "Input"],

Cell["Puncture 1 trajectory", "MathCaption"],

Cell[BoxData[
 RowBox[{
  RowBox[{"traj1", "=", 
   RowBox[{"ReadBHTrajectory", "[", 
    RowBox[{"run", ",", "1"}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"traj0", ",", "traj1"}], "}"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
   RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}]], "Input"],

Cell["Separation of the BHs (radius of relative orbit)", "MathCaption"],

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{"ReadBHSeparation", "[", "run", "]"}], "]"}]], "Input"],

Cell["Phase of orbit", "MathCaption"],

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{"ReadBHPhase", "[", "run", "]"}], "]"}]], "Input"],

Cell["Individual coordinates", "MathCaption"],

Cell[BoxData[
 RowBox[{
  RowBox[{"bh0x", "=", 
   RowBox[{"ReadBHCoordinate", "[", 
    RowBox[{"run", ",", "0", ",", "1"}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", "bh0x", "]"}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Apparent Horizons", "Section"],

Cell["\<\
Remember that AHFinderDirect numbers its horizons from 1, not 0\
\>", "Text"],

Cell["Apparent horizon radius", "MathCaption"],

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{"ReadAHRadius", "[", 
   RowBox[{"run", ",", "1"}], "]"}], "]"}]], "Input"],

Cell["Apparent horizon mass", "MathCaption"],

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{
   RowBox[{"ReadAHMass", "[", 
    RowBox[{"run", ",", "1"}], "]"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0", ",", "1"}], "}"}]}]}], "]"}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Isolated Horizons", "Section"],

Cell["IsolatedHorizon numbers horizons from 0", "Text"],

Cell["Spin of the first black hole", "MathCaption"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"spin", "=", 
   RowBox[{"ReadIsolatedHorizonSpin", "[", 
    RowBox[{"run", ",", "0"}], "]"}]}], ";"}], "\n", 
 RowBox[{"Take", "[", 
  RowBox[{
   RowBox[{"ToList", "[", "spin", "]"}], ",", "10"}], "]"}]}], "Input"],

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{
   RowBox[{"Norm", "[", "spin", "]"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.1"}], ",", "0.8"}], "}"}]}]}], "]"}]], "Input"]
}, Open  ]]
}, Open  ]]
},
Saveable->True,
WindowSize->{725, 750},
WindowMargins->{{229, Automatic}, {Automatic, 0}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
ShowSelection->True,
TrackCellChangeTimes->False,
FrontEndVersion->"8.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (October 5, \
2011)",
StyleDefinitions->"Default.nb"
]

